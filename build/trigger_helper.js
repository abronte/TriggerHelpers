// Generated by CoffeeScript 1.6.2
(function() {
  var Logger, Prefs, Request, isTrigger, root, _base, _ref, _ref1, _ref2, _ref3;

  isTrigger = window.forge !== void 0;

  root = (_ref = (_base = typeof exports !== "undefined" && exports !== null ? exports : window).forge) != null ? _ref : _base.forge = {};

  root.isTrigger = function() {
    return isTrigger;
  };

  Logger = (function() {
    var LEVELS;

    LEVELS = {
      critical: {
        level: 1,
        methodName: "error"
      },
      error: {
        level: 2
      },
      info: {
        level: 3
      },
      warning: {
        level: 4,
        methodName: "info"
      },
      debug: {
        level: 5
      }
    };

    function Logger() {
      var level, methodName, name, _ref1;

      this.logLevel = 5;
      for (name in LEVELS) {
        _ref1 = LEVELS[name], level = _ref1.level, methodName = _ref1.methodName;
        this[name] = function(msg) {
          if (this.logLevel >= level) {
            return console[methodName != null ? methodName : name]("[" + name.toUpperCase() + "] " + msg);
          }
        };
      }
    }

    Logger.prototype.level = function(level) {
      if (level !== void 0) {
        this.logLevel = level;
      }
      return this.logLevel;
    };

    return Logger;

  })();

  if ((_ref1 = root.logging) == null) {
    root.logging = new Logger;
  }

  Prefs = (function() {
    function Prefs() {}

    Prefs.prototype.get = function(key, callback) {
      var _this = this;

      return this._nextTick(function() {
        return typeof callback === "function" ? callback(localStorage.getItem(_this._toForgeKey(key))) : void 0;
      });
    };

    Prefs.prototype.set = function(key, val, callback) {
      localStorage.setItem(this._toForgeKey(key), val);
      return this._nextTick(callback);
    };

    Prefs.prototype.keys = function(callback) {
      var i, key, keys, _i, _ref2;

      keys = [];
      for (i = _i = 0, _ref2 = localStorage.length - 1; 0 <= _ref2 ? _i <= _ref2 : _i >= _ref2; i = 0 <= _ref2 ? ++_i : --_i) {
        key = localStorage.key(i);
        if (this._isForgeKey(key)) {
          keys.push(this._fromForgeKey(key));
        }
      }
      return this._nextTick(function() {
        return callback(keys);
      });
    };

    Prefs.prototype.clear = function(key, callback) {
      localStorage.removeItem(this._toForgeKey(key));
      return this._nextTick(callback);
    };

    Prefs.prototype.clearAll = function(callback) {
      var _this = this;

      return forge.prefs.keys(function(keys) {
        var key, _i, _len;

        for (_i = 0, _len = keys.length; _i < _len; _i++) {
          key = keys[_i];
          localStorage.removeItem(_this._toForgeKey(key));
        }
        return _this._nextTick(callback);
      });
    };

    Prefs.prototype._nextTick = function(cb) {
      if (cb != null) {
        return setTimeout(cb, 1);
      }
    };

    Prefs.prototype._toForgeKey = function(key) {
      return "forge:" + key;
    };

    Prefs.prototype._fromForgeKey = function(key) {
      return key.replace(/^forge:/, "");
    };

    Prefs.prototype._isForgeKey = function(key) {
      return key.match(/^forge:/);
    };

    return Prefs;

  })();

  if ((_ref2 = root.prefs) == null) {
    root.prefs = new Prefs;
  }

  Request = (function() {
    function Request() {}

    Request.prototype.get = function(url, callback) {
      return $.ajax({
        type: "GET",
        url: url,
        dataType: "jsonp",
        processData: false,
        success: callback
      });
    };

    Request.prototype.ajax = function(params) {
      return $.ajax(params);
    };

    return Request;

  })();

  if ((_ref3 = root.request) == null) {
    root.request = new Request;
  }

}).call(this);
